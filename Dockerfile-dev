# ==================================
# Base
# ==================================
FROM node:22.14-alpine AS base
RUN corepack enable && corepack prepare pnpm@latest --activate
WORKDIR /app

# ==================================
# Dev Stage
# ==================================
FROM base AS dev

# Copy dependency files
COPY package.json pnpm-lock.yaml* ./

# Install all deps (dev + prod)
RUN pnpm install --no-frozen-lockfile

# Copy full source
COPY . .

# Generate Prisma client once
RUN pnpm prisma generate || true

EXPOSE 3000
ENV NEXT_TELEMETRY_DISABLED=1

CMD ["pnpm", "dev"]
